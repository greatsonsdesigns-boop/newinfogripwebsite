<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Get URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const paymentId = urlParams.get('id');
        
        // Get payment data from localStorage
        let paymentData = null;
        if (paymentId) {
            const storedData = localStorage.getItem(paymentId);
            if (storedData) {
                paymentData = JSON.parse(storedData);
            }
        }
        
        // If no payment data found, redirect to home
        if (!paymentData) {
            alert('Invalid payment link. Please contact the administrator.');
            window.location.href = 'index.html';
            return;
        }
        
        // Display payment details
        document.getElementById('service-name').textContent = paymentData.service;
        document.getElementById('service-description').textContent = paymentData.description || 'No description provided';
        document.getElementById('service-amount').textContent = '₹' + paymentData.amount;
        document.getElementById('bill-total').textContent = '₹' + paymentData.amount;
        
        // Form elements
        const proceedBtn = document.getElementById('proceed-payment');
        const errorAlert = document.getElementById('error-alert');
        
        // Proceed to payment
        proceedBtn.addEventListener('click', function() {
            const customerName = document.getElementById('customer-name').value;
            const customerEmail = document.getElementById('customer-email').value;
            const customerPhone = document.getElementById('customer-phone').value;
            const customerAddress = document.getElementById('customer-address').value;
            
            // Validate form
            if (!customerName || !customerEmail || !customerPhone) {
                errorAlert.style.display = 'block';
                errorAlert.scrollIntoView({ behavior: 'smooth' });
                return;
            }
            
            errorAlert.style.display = 'none';
            
            // Prepare payment data
            const paymentAmount = parseInt(paymentData.amount) * 100; // Convert to paise
            
            // Create Razorpay order
            createRazorpayOrder(paymentAmount, customerName, customerEmail, customerPhone, customerAddress, paymentData);
        });
        
        // Function to create Razorpay order
        function createRazorpayOrder(amount, name, email, phone, address, serviceData) {
            // YOUR ACTUAL TEST KEY
            const razorpayKeyId = 'rzp_test_RlW88yZEMymKRL';
            
            const options = {
                key: razorpayKeyId,
                amount: amount,
                currency: 'INR',
                name: 'InfoGrip Media Solution',
                description: serviceData.service,
                handler: function(response) {
                    // Payment successful
                    alert('Payment Successful! Payment ID: ' + response.razorpay_payment_id);
                    window.location.href = 'thankyou.html';
                },
                prefill: {
                    name: name,
                    email: email,
                    contact: phone
                },
                notes: {
                    customer_name: name,
                    mobile: phone,
                    address: address,
                    service_name: serviceData.service,
                    service_amount: serviceData.amount,
                    payment_date: new Date().toISOString()
                },
                theme: {
                    color: '#001c4f'
                }
            };
            
            const rzp = new Razorpay(options);
            rzp.open();
            
            // Handle payment failures
            rzp.on('payment.failed', function(response) {
                alert('Payment Failed. Please try again. Error: ' + response.error.description);
            });
        }
    });
</script>
